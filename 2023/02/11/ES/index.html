<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
<script>
(function(){
    if(''){
        if (prompt('请输入文章密码') !== ''){
            alert('密码错误！');
            history.back();
        }
    }
})();
</script>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"angellaugh.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="sudo zypper refreshsudo zypper update -ysudo zypper install yum Import the Elasticsearch GPG Keysudo rpm --import https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;GPG-KEY-elasticsearch Install Elasticsearch from the RPM">
<meta property="og:type" content="article">
<meta property="og:title" content="ES">
<meta property="og:url" content="https://angellaugh.github.io/2023/02/11/ES/index.html">
<meta property="og:site_name" content="Angellaugh&#39;s blog">
<meta property="og:description" content="sudo zypper refreshsudo zypper update -ysudo zypper install yum Import the Elasticsearch GPG Keysudo rpm --import https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;GPG-KEY-elasticsearch Install Elasticsearch from the RPM">
<meta property="og:locale">
<meta property="article:published_time" content="2023-02-11T12:37:46.000Z">
<meta property="article:modified_time" content="2023-02-11T12:46:43.100Z">
<meta property="article:author" content="Angellaugh">
<meta property="article:tag" content="ES">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://angellaugh.github.io/2023/02/11/ES/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>ES | Angellaugh's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Angellaugh's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Angellaugh's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录琐碎</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/02/11/ES/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ES
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-02-11 20:37:46 / Modified: 20:46:43" itemprop="dateCreated datePublished" datetime="2023-02-11T20:37:46+08:00">2023-02-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>sudo zypper refresh<br>sudo zypper update -y<br>sudo zypper install yum</p>
<h3 id="Import-the-Elasticsearch-GPG-Key"><a href="#Import-the-Elasticsearch-GPG-Key" class="headerlink" title="Import the Elasticsearch GPG Key"></a>Import the Elasticsearch GPG Key</h3><p><code>sudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</code></p>
<h3 id="Install-Elasticsearch-from-the-RPM-repository"><a href="#Install-Elasticsearch-from-the-RPM-repository" class="headerlink" title="Install Elasticsearch from the RPM repository"></a>Install Elasticsearch from the RPM repository</h3><p>create elasticsearch.repo and config the es install repo</p>
<p><code>sudo vim /etc/zypp/repos.d/elasticsearch.repo</code></p>
<span id="more"></span>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[elasticsearch]</span><br><span class="line">name=Elasticsearch repository for 8.x packages</span><br><span class="line">baseurl=https://artifacts.elastic.co/packages/8.x/yum</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">enabled=0</span><br><span class="line">autorefresh=1</span><br><span class="line">type=rpm-md</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>install ES</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper modifyrepo --enable elasticsearch &amp;&amp; \</span><br><span class="line">  sudo zypper install elasticsearch; \</span><br><span class="line">  sudo zypper modifyrepo --disable elasticsearch </span><br></pre></td></tr></table></figure>

<p>download and install RPM </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.5.2-x86_64.rpm</span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.5.2-x86_64.rpm.sha512</span><br><span class="line">shasum -a 512 -c elasticsearch-8.5.2-x86_64.rpm.sha512 </span><br><span class="line">sudo rpm --install elasticsearch-8.5.2-x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>config the es start automatically when system boots up</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ES-suse:/etc/zypp/repos.d # sudo /bin/systemctl daemon-reload</span><br><span class="line">ES-suse:/etc/zypp/repos.d # sudo /bin/systemctl enable elasticsearch.service</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/elasticsearch.service → /usr/lib/systemd/system/elasticsearch.service.</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>check the ES</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ES-suse:/etc/zypp/repos.d # rpm -qi elasticsearch</span><br><span class="line">Name        : elasticsearch</span><br><span class="line">Epoch       : 0</span><br><span class="line">Version     : 7.17.7</span><br><span class="line">Release     : 1</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: Sun Dec  4 21:37:47 2022</span><br><span class="line">Group       : Application/Internet</span><br><span class="line">Size        : 525810397</span><br><span class="line">License     : Elastic License</span><br><span class="line">Signature   : RSA/SHA512, Mon Oct 17 14:57:09 2022, Key ID d27d666cd88e42b4</span><br><span class="line">Source RPM  : elasticsearch-7.17.7-1-src.rpm</span><br><span class="line">Build Date  : Mon Oct 17 11:35:59 2022</span><br><span class="line">Build Host  : packer-virtualbox-iso-1646848364</span><br><span class="line">Relocations : /usr</span><br><span class="line">Packager    : Elasticsearch</span><br><span class="line">Vendor      : Elasticsearch</span><br><span class="line">URL         : https://www.elastic.co/</span><br><span class="line">Summary     : Distributed RESTful search engine built for the cloud</span><br><span class="line">Description :</span><br><span class="line">Reference documentation can be found at</span><br><span class="line">  https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</span><br><span class="line">  and the &#x27;Elasticsearch: The Definitive Guide&#x27; book can be found at</span><br><span class="line">  https://www.elastic.co/guide/en/elasticsearch/guide/current/index.html</span><br><span class="line">Distribution: Elasticsearch</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>start es server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ES-suse:/etc/zypp/repos.d # sudo systemctl start elasticsearch</span><br><span class="line">ES-suse:/etc/zypp/repos.d # sudo systemctl status elasticsearch</span><br><span class="line">● elasticsearch.service - Elasticsearch</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/elasticsearch.service; disabled; vendor preset: disabled)</span><br><span class="line">     Active: active (running) since Sun 2022-12-04 21:39:35 EST; 21s ago</span><br><span class="line">       Docs: https://www.elastic.co</span><br><span class="line">   Main PID: 8555 (java)</span><br><span class="line">      Tasks: 97 (limit: 4915)</span><br><span class="line">     CGroup: /system.slice/elasticsearch.service</span><br><span class="line">             ├─ 8555 /usr/share/elasticsearch/jdk/bin/java -Xshare:auto -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+Always&gt;</span><br><span class="line">             └─ 8767 /usr/share/elasticsearch/modules/x-pack-ml/platform/linux-x86_64/bin/controller</span><br><span class="line"></span><br><span class="line">Dec 04 21:39:17 ES-suse systemd[1]: Starting Elasticsearch...</span><br><span class="line">Dec 04 21:39:35 ES-suse systemd[1]: Started Elasticsearch.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>related log:<br><code> vi /var/log/elasticsearch/elasticsearch.log</code></p>
<p>datapath<br><code>/var/lib/elasticsearch</code></p>
<p>To list journal entries for the elasticsearch service:</p>
<p><code>sudo journalctl --unit elasticsearch</code></p>
<p>verify es installation</p>
<ol>
<li><code>ss -antpl | grep 9200</code></li>
<li><code>curl -X GET &quot;localhost:9200/&quot;</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ES-suse:/etc/zypp/repos.d # ss -antpl | grep 9200</span><br><span class="line">LISTEN 0      4096   [::ffff:127.0.0.1]:9200             *:*    users:((&quot;java&quot;,pid=8555,fd=305))</span><br><span class="line">LISTEN 0      4096                [::1]:9200          [::]:*    users:((&quot;java&quot;,pid=8555,fd=304))</span><br><span class="line">ES-suse:/etc/zypp/repos.d # curl -X GET &quot;localhost:9200/&quot;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;ES-suse&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;0zL15OxVTY6SrXO2aQ6qGQ&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.17.7&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;rpm&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;78dcaaa8cee33438b91eca7f5c7f56a70fec9e80&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2022-10-17T15:29:54.167373105Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.11.1&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>input one data:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Content-Type: application/json&#x27; -X POST &#x27;http://localhost:9200/todo/task/1&#x27; -d &#x27;&#123; &quot;name&quot;: &quot;Go to the mall.&quot; &#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>and read it again:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ES-suse:/etc/zypp/repos.d # curl -X GET &#x27;http://localhost:9200/todo/task/1?pretty&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;todo&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;task&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">  &quot;_version&quot; : 1,</span><br><span class="line">  &quot;_seq_no&quot; : 0,</span><br><span class="line">  &quot;_primary_term&quot; : 1,</span><br><span class="line">  &quot;found&quot; : true,</span><br><span class="line">  &quot;_source&quot; : &#123;</span><br><span class="line">    &quot;name&quot; : &quot;Go to the mall.&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>










<p> curl -XGET ‘<a target="_blank" rel="noopener" href="http://localhost:9200/_nodes/stats?pretty&#39;">http://localhost:9200/_nodes/stats?pretty&#39;</a> | grep thread</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#125;ES-suse:/etc/zypp/repos.d #  curl -XGET &#x27;http://localhost:9200/_nodes/stats?pretty&#x27; | grep thread</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 39463  100 39463    0     0  1144k      0 --:--:-- --:--:--        &quot;threads&quot; : &#123;</span><br><span class="line"> --:--:--      &quot;thread_pool&quot; : &#123;</span><br><span class="line"> 1          &quot;threads&quot; : 0,</span><br><span class="line">16          &quot;threads&quot; : 0,</span><br><span class="line">7          &quot;threads&quot; : 0,</span><br><span class="line">k          &quot;threads&quot; : 0,</span><br><span class="line"></span><br><span class="line">          &quot;threads&quot; : 0,</span><br><span class="line">          &quot;threads&quot; : 1,</span><br><span class="line">          &quot;threads&quot; : 0,</span><br><span class="line">          &quot;threads&quot; : 11,</span><br><span class="line">          &quot;threads&quot; : 2,</span><br><span class="line">          &quot;threads&quot; : 0,</span><br><span class="line">          &quot;threads&quot; : 2,</span><br><span class="line">          &quot;threads&quot; : 0,</span><br><span class="line">          &quot;threads&quot; : 0,</span><br><span class="line">          &quot;threads&quot; : 1,</span><br><span class="line">          &quot;threads&quot; : 3,</span><br><span class="line">          &quot;threads&quot; : 0,</span><br><span class="line">          &quot;threads&quot; : 0,</span><br><span class="line">          &quot;threads&quot; : 0,</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ES-suse:/etc # ll /usr/share/elasticsearch/bin</span><br><span class="line">total 3028</span><br><span class="line">-rwxr-xr-x 1 root root     101 Nov 17 14:04 elasticsearch</span><br><span class="line">-rwxr-xr-x 1 root root     376 Nov 17 13:59 elasticsearch-certgen</span><br><span class="line">-rwxr-xr-x 1 root root     376 Nov 17 13:59 elasticsearch-certutil</span><br><span class="line">-rwxr-xr-x 1 root root     674 Nov 17 14:04 elasticsearch-cli</span><br><span class="line">-rwxr-xr-x 1 root root     353 Nov 17 13:59 elasticsearch-create-enrollment-token</span><br><span class="line">-rwxr-xr-x 1 root root     352 Nov 17 13:59 elasticsearch-croneval</span><br><span class="line">-rwxr-xr-x 1 root root    2340 Nov 17 14:04 elasticsearch-env</span><br><span class="line">-rwxr-xr-x 1 root root    2595 Nov 17 14:04 elasticsearch-env-from-file</span><br><span class="line">-rwxr-xr-x 1 root root      84 Nov 17 14:04 elasticsearch-geoip</span><br><span class="line">-rwxr-xr-x 1 root root      87 Nov 17 14:04 elasticsearch-keystore</span><br><span class="line">-rwxr-xr-x 1 root root      55 Nov 17 14:04 elasticsearch-node</span><br><span class="line">-rwxr-xr-x 1 root root     172 Nov 17 14:04 elasticsearch-plugin</span><br><span class="line">-rwxr-xr-x 1 root root     376 Nov 17 13:59 elasticsearch-reconfigure-node</span><br><span class="line">-rwxr-xr-x 1 root root     353 Nov 17 13:59 elasticsearch-reset-password</span><br><span class="line">-rwxr-xr-x 1 root root     353 Nov 17 13:59 elasticsearch-saml-metadata</span><br><span class="line">-rwxr-xr-x 1 root root     353 Nov 17 13:59 elasticsearch-service-tokens</span><br><span class="line">-rwxr-xr-x 1 root root     353 Nov 17 13:59 elasticsearch-setup-passwords</span><br><span class="line">-rwxr-xr-x 1 root root      55 Nov 17 14:04 elasticsearch-shard</span><br><span class="line">-rwxr-xr-x 1 root root     403 Nov 17 13:59 elasticsearch-sql-cli</span><br><span class="line">-rwxr-xr-x 1 root root 3008975 Nov 17 13:59 elasticsearch-sql-cli-8.5.2.jar</span><br><span class="line">-rwxr-xr-x 1 root root     353 Nov 17 13:59 elasticsearch-syskeygen</span><br><span class="line">-rwxr-xr-x 1 root root     353 Nov 17 13:59 elasticsearch-users</span><br><span class="line">-rwxr-xr-x 1 root root     332 Nov 17 14:01 systemd-entrypoint</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="health-check"><a href="#health-check" class="headerlink" title="health check"></a>health check</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;localhost:9200/_cat/health?v&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="nodes-list"><a href="#nodes-list" class="headerlink" title="nodes list"></a>nodes list</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;localhost:9200/_cat/nodes?v&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="index-list"><a href="#index-list" class="headerlink" title="index list"></a>index list</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;localhost:9200/_cat/indices?v&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="search-detail-data-using-index"><a href="#search-detail-data-using-index" class="headerlink" title="search detail data using index"></a>search detail data using index</h3><p><code>curl -X GET http://localhost:9200/je_index_1663720218/</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@powerload-es-2:~ # curl -X GET http://localhost:9200/je_index_1663720218/_search?pretty</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 7,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 5,</span><br><span class="line">    &quot;successful&quot; : 5,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 0,</span><br><span class="line">    &quot;max_score&quot; : null,</span><br><span class="line">    &quot;hits&quot; : [ ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="查看集群全部节点的指标"><a href="#查看集群全部节点的指标" class="headerlink" title="查看集群全部节点的指标"></a>查看集群全部节点的指标</h1><p>$ curl “localhost:9200/_nodes/stats”</p>
<hr>
<p>Issue1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ES-suse:/etc/zypp/repos.d # sudo systemctl enable elasticsearch</span><br><span class="line">Synchronizing state of elasticsearch.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.</span><br><span class="line">Executing: /usr/lib/systemd/systemd-sysv-install enable elasticsearch</span><br><span class="line">ln -sf ../elasticsearch /etc/init.d/rc2.d/S50elasticsearch</span><br><span class="line">ln: failed to create symbolic link &#x27;/etc/init.d/rc2.d/S50elasticsearch&#x27;: No such file or directory</span><br></pre></td></tr></table></figure>

<p>It seems that this product is not from the standard openSUSE OSS repo.</p>
<p>It tries to use /etc/init.d/rc2.d which directory belongs to the old SystemV ways of doing (as the message also says). but in openSUSE that directory is no longer in use and most probably not available anymore.</p>
<p>Issue2: refused了</p>
<p>root@ldm-controller-01:/usr/local/stress_test/Island_TPPC # curl -X GET “<a target="_blank" rel="noopener" href="http://10.219.61.175:9200/_cat/indices?v&quot;">http://10.219.61.175:9200/_cat/indices?v&quot;</a><br>curl: (7) Failed connect to 10.219.61.175:9200; Connection refused</p>
<p>—————————————Dry run es-opensuse on powerload————————<br>Config ES-suse to powerload json file</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ldm-controller-01:/usr/local/stress_test/Island_TPPC # nslookup ES-suse.west.isilon.com</span><br><span class="line">Server:         10.231.252.14</span><br><span class="line">Address:        10.231.252.14#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:   ES-suse.west.isilon.com</span><br><span class="line">Address: 10.219.61.175</span><br></pre></td></tr></table></figure>

<p>![](vx_images/65815239672.png =800x)</p>
<h3 id="cat-methods"><a href="#cat-methods" class="headerlink" title="cat methods"></a>cat methods</h3><p><code>curl http://localhost:9200/_cat</code></p>
<p>ES-suse:/var/lib/elasticsearch #  curl <a target="_blank" rel="noopener" href="http://localhost:9200/_cat">http://localhost:9200/_cat</a><br>=^.^=<br>/_cat/allocation<br>/_cat/shards<br>/_cat/shards/{index}<br>/_cat/master<br>/_cat/nodes<br>/_cat/tasks<br>/_cat/indices<br>/_cat/indices/{index}<br>/_cat/segments<br>/_cat/segments/{index}<br>/_cat/count<br>/_cat/count/{index}<br>/_cat/recovery<br>/_cat/recovery/{index}<br>/_cat/health<br>/_cat/pending_tasks<br>/_cat/aliases<br>/_cat/aliases/{alias}<br>/_cat/thread_pool<br>/_cat/thread_pool/{thread_pools}<br>/_cat/plugins<br>/_cat/fielddata<br>/_cat/fielddata/{fields}<br>/_cat/nodeattrs<br>/_cat/repositories<br>/_cat/snapshots/{repository}<br>/_cat/templates<br>/_cat/ml/anomaly_detectors<br>/_cat/ml/anomaly_detectors/{job_id}<br>/_cat/ml/trained_models<br>/_cat/ml/trained_models/{model_id}<br>/_cat/ml/datafeeds<br>/_cat/ml/datafeeds/{datafeed_id}<br>/_cat/ml/data_frame/analytics<br>/_cat/ml/data_frame/analytics/{id}<br>/_cat/transforms<br>/_cat/transforms/{transform_id}</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7145773678649671694">https://juejin.cn/post/7145773678649671694</a></p>
<p>curl localhost:9200/_cat/nodes?help</p>
<h1 id="指定查看每个节点的堆内存使用率，段数量和合并数量"><a href="#指定查看每个节点的堆内存使用率，段数量和合并数量" class="headerlink" title="指定查看每个节点的堆内存使用率，段数量和合并数量"></a>指定查看每个节点的堆内存使用率，段数量和合并数量</h1><p>$ curl “<a target="_blank" rel="noopener" href="http://localhost:9200/_cat/nodes?h=http,heapPercent,segmentsCount,mergesTotal&quot;">http://localhost:9200/_cat/nodes?h=http,heapPercent,segmentsCount,mergesTotal&quot;</a><br>172.16.71.231:9200 56 99 108182<br>172.16.71.229:9200 31 95 122551<br>172.16.71.232:9200 50 66  73871<br>172.16.71.230:9200 41 63  76470<br>172.16.71.234:9200 32 64  93256<br>172.16.71.233:9200 14 90 136450</p>
<p>当集群为red或者yellow的时候怎么办<br>集群为RED表示集群中有primary shard没有分配，yellow表示有replica没有分配</p>
<p>root@powerload-es-2:/var/lib/elasticsearch/nodes # curl -X GET “<a target="_blank" rel="noopener" href="http://localhost:9200/_cluster/allocation/explain?pretty&quot;">http://localhost:9200/_cluster/allocation/explain?pretty&quot;</a><br>{<br>  “index” : “je_index_1664986024”,<br>  “shard” : 3,<br>  “primary” : false,<br>  “current_state” : “unassigned”,<br>  “unassigned_info” : {<br>    “reason” : “CLUSTER_RECOVERED”,<br>    “at” : “2022-12-05T02:18:25.712Z”,<br>    “last_allocation_status” : “no_attempt”<br>  },<br>  “can_allocate” : “no”,<br>  “allocate_explanation” : “cannot allocate because allocation is not permitted to any of the nodes”,<br>  “node_allocation_decisions” : [<br>    {<br>      “node_id” : “R2DFntg7RLiwYsEN4mwYuw”,<br>      “node_name” : “R2DFntg”,<br>      “transport_address” : “10.219.61.247:9300”,<br>      “node_attributes” : {<br>        “ml.machine_memory” : “16656269312”,<br>        “xpack.installed” : “true”,<br>        “ml.max_open_jobs” : “20”,<br>        “ml.enabled” : “true”<br>      },<br>      “node_decision” : “no”,<br>      “deciders” : [<br>        {<br>          “decider” : “same_shard”,<br>          “decision” : “NO”,<br>          “explanation” : “the shard cannot be allocated to the same node on which a copy of the shard already exists [[je_index_1664986024][3], node[R2DFntg7RLiwYsEN4mwYuw], [P], s[STARTED], a[id=488Lf_8lTI2raran4YNWoQ]]”<br>        }<br>      ]<br>    }<br>  ]<br>}</p>
<p>分片长时间处于未分配状态 ES内部会对一个unassigned 分片尝试5次进行分配,失败后不再尝试进行分配，这时候需要调用进行手动控制集群处理 unassigned 分片：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Before starting Elasticsearch for the first time</span><br><span class="line">Set xpack.security.enabled: false and then start Elasticsearch</span><br><span class="line"></span><br><span class="line">After you have started Elasticsearch for the first time</span><br><span class="line">You have two options here</span><br><span class="line"></span><br><span class="line">Set</span><br><span class="line"></span><br><span class="line">xpack.security.enabled: false</span><br><span class="line">xpack.security.transport.ssl.enabled: false</span><br><span class="line">xpack.security.http.ssl.enabled: false</span><br><span class="line">and then start Elasticsearch.</span><br><span class="line"></span><br><span class="line">Run</span><br><span class="line"></span><br><span class="line">bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password</span><br><span class="line">bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</span><br><span class="line">bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</span><br><span class="line">Set</span><br><span class="line"></span><br><span class="line">xpack.security.enabled: false</span><br></pre></td></tr></table></figure>


<h3 id="change-timezone"><a href="#change-timezone" class="headerlink" title="change timezone"></a>change timezone</h3><p>step1: vi /etc/sysconfig/clock</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_TIMEZONE=&quot;Etc/GMT&quot;</span><br><span class="line">ZONE=&quot;Etc/GMT&quot;</span><br><span class="line">~</span><br><span class="line">```  </span><br><span class="line">step2: zic -l Etc/GMT</span><br><span class="line">step3: date</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ES-suse:/var/log/elasticsearch # date<br>Tue Dec  6 03:46:47 EST 2022<br>ES-suse:/var/log/elasticsearch # vi /etc/sysconfig/clock<br>ES-suse:/var/log/elasticsearch # zic -l Etc/GMT<br>ES-suse:/var/log/elasticsearch # date<br>Tue Dec  6 08:55:46 GMT 2022</p>
<pre><code>
</code></pre>

    </div>

    
    
    
        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ES/" rel="tag"># ES</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/11/hello-world/" rel="prev" title="Hello World">
      <i class="fa fa-chevron-left"></i> Hello World
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/02/11/es-suse/" rel="next" title="es-suse">
      es-suse <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Import-the-Elasticsearch-GPG-Key"><span class="nav-text">Import the Elasticsearch GPG Key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-Elasticsearch-from-the-RPM-repository"><span class="nav-text">Install Elasticsearch from the RPM repository</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#health-check"><span class="nav-text">health check</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nodes-list"><span class="nav-text">nodes list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#index-list"><span class="nav-text">index list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#search-detail-data-using-index"><span class="nav-text">search detail data using index</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E5%85%A8%E9%83%A8%E8%8A%82%E7%82%B9%E7%9A%84%E6%8C%87%E6%A0%87"><span class="nav-text">查看集群全部节点的指标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cat-methods"><span class="nav-text">cat methods</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E6%9F%A5%E7%9C%8B%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E5%A0%86%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87%EF%BC%8C%E6%AE%B5%E6%95%B0%E9%87%8F%E5%92%8C%E5%90%88%E5%B9%B6%E6%95%B0%E9%87%8F"><span class="nav-text">指定查看每个节点的堆内存使用率，段数量和合并数量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#change-timezone"><span class="nav-text">change timezone</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Angellaugh"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Angellaugh</p>
  <div class="site-description" itemprop="description">技术，生活，艺术，旅行，都记录下来</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Angellaugh</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

<div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv" style='display:none'>
    本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
    <span class="post-meta-divider">|</span>
</span>
<span id="busuanzi_container_site_uv" style='display:none'>
    有<span id="busuanzi_value_site_uv"></span>人看过我的博客啦
</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
