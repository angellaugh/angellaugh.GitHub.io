<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"angellaugh.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="技术，生活，艺术，旅行，都记录下来">
<meta property="og:type" content="website">
<meta property="og:title" content="Angellaugh&#39;s blog">
<meta property="og:url" content="https://angellaugh.github.io/index.html">
<meta property="og:site_name" content="Angellaugh&#39;s blog">
<meta property="og:description" content="技术，生活，艺术，旅行，都记录下来">
<meta property="og:locale">
<meta property="article:author" content="Angellaugh">
<meta property="article:tag" content="java, python, javascript, linux, storage, db, performance">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://angellaugh.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>Angellaugh's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Angellaugh's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Angellaugh's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录琐碎</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/04/12/daily/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/12/daily/" class="post-title-link" itemprop="url">Multiprocess_2 concurrent</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-12 23:34:02" itemprop="dateCreated datePublished" datetime="2023-04-12T23:34:02+00:00">2023-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-return-坑死我了"><a href="#1-return-坑死我了" class="headerlink" title="1. return 坑死我了"></a>1. return 坑死我了</h2><p>return是表示从被调函数返回到主调函数继续执行, return后函数就结束了,后面的语句不再执行</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/04/11/multiprocess_concurrent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/11/multiprocess_concurrent/" class="post-title-link" itemprop="url">Multiprocess_2 concurrent</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-11 23:17:02" itemprop="dateCreated datePublished" datetime="2023-04-11T23:17:02+00:00">2023-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><p><mark>1. time.perf_counter()  程序运行时间包括sleeping</mark>, 不用再 time.time()-starttime了。<br>2. time.process_counter() cpu运行时间，不包括sleeping<br><mark>3. concurrent.futures: 两个process 并行运行 </mark><br>4. 注意 python3.7以上才能打印出秒数<br>5. 注意不要用和包名相同的文件名<br><mark>6. Pool.map 可以取代 map(func, list)</mark></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sleep_for_a_bit</span>(<span class="params">secondes</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Sleeping <span class="subst">&#123;secondes&#125;</span> second(s)&quot;</span>)</span><br><span class="line">    time.sleep(secondes)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Done sleeping&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> concurrent.futures.ProcessPoolExecutor() <span class="keyword">as</span> executor:</span><br><span class="line">    <span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">        f1 = executor.submit(sleep_for_a_bit, <span class="number">1</span>)</span><br><span class="line">        f2 = executor.submit(sleep_for_a_bit, <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(f1.result())</span><br><span class="line">        <span class="built_in">print</span>(f2.result())</span><br><span class="line">        </span><br><span class="line">finish = time.perf_counter()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Finished in time: &quot;</span>, finish)</span><br></pre></td></tr></table></figure>

<pre><code>~/Desktop 🔥» python ccc.py                                      vivi@vivis-MBP
Finished in time:  0.103320167
Finished in time:  0.100869
Sleeping 1 second(s)
Sleeping 1 second(s)
Finished in time:  0.099204041
Finished in time:  0.095198
Finished in time:  0.077157417
Finished in time:  0.084327958
Finished in time:  0.080791833
Finished in time:  0.084751625
Done sleeping
Done sleeping
Finished in time:  1.282027666
</code></pre>
<h2 id="Pool-map-func-list-来取代-list-map-func-list"><a href="#Pool-map-func-list-来取代-list-map-func-list" class="headerlink" title="Pool.map(func, list) 来取代 list(map(func, list))"></a>Pool.map(func, list) 来取代 list(map(func, list))</h2><ol>
<li>但是看上去没发现节省时间</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">x = <span class="built_in">list</span>(<span class="built_in">map</span>(req_get, create_list.keys()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_get</span>():</span><br><span class="line">    <span class="keyword">with</span> Pool(core_num) <span class="keyword">as</span> p:</span><br><span class="line">        x = p.<span class="built_in">map</span>(req_get, create_list.keys())</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>If x equals get_list:369,  369
[2023-04-11 14:08:28] [Line: 184] INFO - Total running time: 53.477982
[2023-04-11 14:08:28] [Line: 185] INFO - Create clients number:369
[2023-04-11 14:08:28] [Line: 186] INFO - Get clients number: 369
[2023-04-11 14:08:28] [Line: 187] ERROR - Create clients fail number: 0
[2023-04-11 14:08:28] [Line: 188] ERROR - Create clients fail information: []
369
369
369
369
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/04/11/understandmapyieldlambda.py/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/11/understandmapyieldlambda.py/" class="post-title-link" itemprop="url">Understandmapyieldlambda</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-11 22:13:02" itemprop="dateCreated datePublished" datetime="2023-04-11T22:13:02+00:00">2023-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h1> <p>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">numbers = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">square</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x * x</span><br><span class="line"></span><br><span class="line">a= []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只会这么写，或者next</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> numbers:</span><br><span class="line">    a.append(square(x))</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">map(function, *iterables)</span></span><br><span class="line"><span class="string">对指定序列做映射，返回值是个迭代器，可迭代对象： list，set， tuple</span></span><br><span class="line"><span class="string">map 取代for循环</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">square_num = <span class="built_in">map</span>(square, numbers)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(square_num))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(square_num)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在list的时候调用了square_num，迭代5次，并且把每次迭代的return 都append进list中。</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(square_num))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>[4, 16, 36, 64, 25]
&lt;class &#39;map&#39;&gt;
&lt;map object at 0x1109a2c40&gt;
[4, 16, 36, 64, 25]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 类似于</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testyield</span>(<span class="params">numbers</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> numbers:</span><br><span class="line">        <span class="keyword">yield</span> square(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># my way</span></span><br><span class="line">a = testyield(numbers)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;next <span class="subst">&#123;<span class="built_in">next</span>(a)&#125;</span>&quot;</span>)  <span class="comment"># list就是对每个元素next的动作</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># list can call the generator list就是一个循环call 迭代器的动作， next       </span></span><br><span class="line">a = <span class="built_in">list</span>(testyield(numbers))</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#将传入list，改写成传入单个元素，去掉for循环，外面用map取代for</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testyield2</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="comment">#yield square(x) 这里不行。。 貌似yield必须要和for循环在一起</span></span><br><span class="line">    <span class="keyword">return</span> square(x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;testyield2 with map&quot;</span>)</span><br><span class="line">a = <span class="built_in">map</span>(testyield2, numbers)</span><br><span class="line"><span class="comment"># is a map object</span></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># is a generator</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(a))</span><br><span class="line"><span class="comment"># is a list gegerator</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(a))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testyield4</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;under testyield444&quot;</span>)</span><br><span class="line">    a =<span class="keyword">yield</span> square(x)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;aa&quot;</span>)</span><br><span class="line">g = testyield4(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(g)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;call the testyield4 <span class="subst">&#123;<span class="built_in">next</span>(g)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># for x in numbers:</span></span><br><span class="line"><span class="comment">#     g = testyield4(x)</span></span><br><span class="line"><span class="comment">#     print(next(g))</span></span><br><span class="line">    </span><br><span class="line">aa = [<span class="built_in">next</span>(testyield4(x)) <span class="keyword">for</span> x <span class="keyword">in</span> numbers]</span><br><span class="line"><span class="built_in">print</span>(aa)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">return 和 list[map(func, parameters)]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">yield 和list[next(func(x)) for x in parameters]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/04/05/mapinuse/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/05/mapinuse/" class="post-title-link" itemprop="url">mapinuse</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-05 22:13:02" itemprop="dateCreated datePublished" datetime="2023-04-05T22:13:02+00:00">2023-04-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-map-reduce-zip-filter-对序列操作"><a href="#1-map-reduce-zip-filter-对序列操作" class="headerlink" title="1. map, reduce, zip, filter 对序列操作"></a>1. map, reduce, zip, filter 对序列操作</h2><p>对指定序列做映射，返回值是迭代器</p>
<h2 id="2-map"><a href="#2-map" class="headerlink" title="2. map"></a>2. map</h2><p>收获：</p>
<ol>
<li>map(func, list_) 是一个迭代器，需要一个一个取，取一次运行一次，拿到一次值；</li>
<li>next: 可以取一次迭代器的值；如果取到最后没值了会抛出一个错；</li>
<li>list: 可以遍历取多次迭代器，直到取到所有值，并且存到list中；</li>
<li>list(map(func, list_)) 可以取代之前的旧写法，定义一个变量，type=list, 然后for循环取值append到这个变量list中；</li>
<li>list[func(x) for x in list_]  也可以稍微简写一下for循环；</li>
</ol>
<p><strong>小补充： list还真是遍历多次迭代取值</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nums = <span class="built_in">range</span>(-<span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(nums)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(nums))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(nums))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">range(-5, 6)</span></span><br><span class="line"><span class="string">&lt;class &#x27;range&#x27;&gt;</span></span><br><span class="line"><span class="string">[-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="2-1-map-func-iterables"><a href="#2-1-map-func-iterables" class="headerlink" title="2.1. map(func, iterables)"></a>2.1. map(func, iterables)</h3><p>map(function, *iterables)<br>对指定序列做映射，返回值是个迭代器，可迭代对象： list，set， tuple<br>map 取代for循环</p>
<p>list(map(function, *iteratbles))  == [function(iterable) for iterable in iterables]</p>
<h3 id="2-2-最常理解的实现是for循环，把结果收集到一个提前定义好的list中"><a href="#2-2-最常理解的实现是for循环，把结果收集到一个提前定义好的list中" class="headerlink" title="2.2. 最常理解的实现是for循环，把结果收集到一个提前定义好的list中"></a>2.2. 最常理解的实现是for循环，把结果收集到一个提前定义好的list中</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">numbers = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">square</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x * x</span><br><span class="line">a= []</span><br><span class="line"><span class="comment"># 只会这么写，或者next</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> numbers:</span><br><span class="line">    a.append(square(x))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a: <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">b = [square(x) <span class="keyword">for</span> x <span class="keyword">in</span> numbers]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a: <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">map(function, *iterables)</span></span><br><span class="line"><span class="string">对指定序列做映射，返回值是个迭代器，可迭代对象： list，set， tuple</span></span><br><span class="line"><span class="string">map 取代for循环</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<pre><code>a: [4, 16, 36, 64, 25]
b: [4, 16, 36, 64, 25]
</code></pre>
<h3 id="2-3-进阶：-使用map-简化掉for循环以及提前定义list"><a href="#2-3-进阶：-使用map-简化掉for循环以及提前定义list" class="headerlink" title="2.3. 进阶： 使用map 简化掉for循环以及提前定义list"></a>2.3. 进阶： 使用map 简化掉for循环以及提前定义list</h3><mark>
list(map(func, list_))： 等于 for 循环取出 map得到的len(list_)个元素并且append到一个list中；

<ol>
<li>next 可以取出 map迭代器的值；</li>
<li>for 语句等同于 next的效果，挨个取出map迭代器的值；</li>
<li>list(map(func, list_)) 等于 point2 并且append到一个list中；</mark></li>
</ol>
<h4 id="2-3-1-举例-next-效果，更深刻理解list-map-的效果"><a href="#2-3-1-举例-next-效果，更深刻理解list-map-的效果" class="headerlink" title="2.3.1. 举例 next 效果，更深刻理解list(map)的效果"></a>2.3.1. 举例 next 效果，更深刻理解list(map)的效果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">numbers = [2, 4, 6, 8, 5]</span><br><span class="line">def square(x):</span><br><span class="line">    return x * x</span><br><span class="line"></span><br><span class="line"># type: class map, object</span><br><span class="line">square_num = map(square, numbers)</span><br><span class="line">print(type(square_num))</span><br><span class="line">print(square_num)</span><br><span class="line"># 在list的时候调用了square_num，迭代5次，并且把每次迭代的return 都append进list中。</span><br><span class="line"># 类似于next(square_num)了5次</span><br><span class="line"># 也类似于for循环把每个迭代元素调用一次，得到的值加入到list中。</span><br><span class="line">print(next(square_num))  #4</span><br><span class="line">print(list(square_num))  # 因为上面next已经取走了第一个值，所以list这里只剩下4个值</span><br></pre></td></tr></table></figure>
<pre><code>&lt;class &#39;map&#39;&gt;
&lt;map object at 0x110a75c70&gt;
4
[16, 36, 64, 25] 
</code></pre>
<h4 id="2-3-2-举例-for循环取出值append到list中，用list-map-来取代for循环。"><a href="#2-3-2-举例-for循环取出值append到list中，用list-map-来取代for循环。" class="headerlink" title="2.3.2. 举例 for循环取出值append到list中，用list(map)来取代for循环。"></a>2.3.2. 举例 for循环取出值append到list中，用list(map)来取代for循环。</h4><p><mark><del>其实精简了两次for循环</del> 其实是map+list 两个动作 一起取代了 for循环和list.append</p>
<ol>
<li>numbsers 和 square 用map来一一映射；</li>
<li>list(map) 达到了 一个一个for 并且 append的效果；</li>
<li>啊哈哈哈 意外之喜，理解了另一个写法：b = [square(x) for x in numbers]</mark>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/04/05/mapinuse/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/04/02/openssl_ca2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/02/openssl_ca2/" class="post-title-link" itemprop="url">openssl_ca2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-02 11:11:02" itemprop="dateCreated datePublished" datetime="2023-04-02T11:11:02+00:00">2023-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-CA-简介-amp-范例"><a href="#1-CA-简介-amp-范例" class="headerlink" title="1. CA 简介 &amp; 范例"></a>1. CA 简介 &amp; 范例</h2><p><strong>CA</strong>= certificate authority签证机构<br>提供证书（服务器证书，由域名、公司信息、序列号和签名信息组成）</p>
<p><strong>SSL:</strong> Secure Sockets Layer（安全套接层协议), 与HTTPS一起诞生<br><strong>TLS:</strong> TLS，Transport Layer Security（传输层安全性协议）， 是SSL 标准化<br><mark><strong>SSL &amp; TLS： 本质是同一个东东</strong></mark></p>
<p><strong>证书包含：</strong></p>
<ol>
<li>public key、</li>
<li>名称、 </li>
<li><mark>CA的数字签名</mark></li>
<li>有效时间，</li>
<li>签证机关的名称，</li>
<li>该证书的序列号等信息</li>
</ol>
<div class="note primary">
            <p>现在该说点什么呢</p>
          </div>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 2.4. View the issued CA</span></span><br><span class="line">```bash</span><br><span class="line">CIAM-ali1:~/CAcerts <span class="comment"># openssl x509 -text -noout -in server.pem</span></span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number: 4096 (0x1000)</span><br><span class="line">        Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        <span class="comment"># 签证机构</span></span><br><span class="line">        Issuer: C = CN, ST = Shanghai, L = Shanghai, O = Dell, OU = Dell</span><br><span class="line">        <span class="comment">#有效期</span></span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Mar 27 08:22:59 2023 GMT</span><br><span class="line">            Not After : Mar 26 08:22:59 2024 GMT</span><br><span class="line">        <span class="comment"># 名字    </span></span><br><span class="line">        Subject: C = CN, ST = Shanghai, O = Dell, OU = Dell, CN = ciam-ali1.west.isilon.com</span><br><span class="line">        <span class="comment">#public key</span></span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                RSA Public-Key: (2048 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:e8:53:ef:bd:b0:e9:99:2b:af:35:da:2e:b5:81:</span><br><span class="line">                    61:18:17:7a:7b:69:a0:46:c1:c2:ee:24:d7:36:52:</span><br><span class="line">                    e9:5c:3d:49:ea:be:31:54:e0:a5:ff:a9:e1:19:b3:</span><br><span class="line">                    81:8a:38:9e:a3:fa:62:23:b0:85:07:d1:35:3e:40:</span><br><span class="line">                    7c:1a:68:1d:a8:6b:08:01:c8:95:d3:85:09:b0:7c:</span><br><span class="line">                    60:85:dc:13:dc:91:a2:73:ee:f3:7e:42:80:99:24:</span><br><span class="line">                    4f:09:13:91:9b:da:87:ee:ae:f2:ec:d9:9e:a6:75:</span><br><span class="line">                    1d:e3:c6:cf:78:58:7d:2a:7e:8e:cf:65:30:60:ab:</span><br><span class="line">                    42:6b:6d:76:f8:f2:46:de:c3:b5:4b:c9:60:39:24:</span><br><span class="line">                    a0:5e:59:0c:b3:30:9e:3b:67:ae:d4:5f:53:6e:63:</span><br><span class="line">                    47:92:dc:0c:39:9f:a6:39:b0:45:82:5b:e1:4d:a8:</span><br><span class="line">                    ed:75:96:8a:98:32:49:f6:9b:a3:6e:69:91:f0:18:</span><br><span class="line">                    2e:66:9e:ca:77:7e:b3:a6:96:d6:4a:e1:b1:51:a3:</span><br><span class="line">                    1f:7d:d2:5f:41:ce:1c:02:c2:42:aa:b5:3b:61:1c:</span><br><span class="line">                    9f:b9:45:70:fe:85:d0:d8:a3:6f:e5:e8:3d:9f:9e:</span><br><span class="line">                    6d:53:57:f9:0f:0a:56:a4:f5:77:bb:4a:ff:<span class="built_in">fc</span>:8a:</span><br><span class="line">                    4a:67:e1:82:43:f1:7b:16:5a:80:1b:8f:da:f4:c4:</span><br><span class="line">                    25:0d</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints:</span><br><span class="line">                CA:FALSE</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                D1:4F:3F:CD:DC:17:7E:50:38:A8:50:D6:EA:2C:BA:3D:6C:62:35:A1</span><br><span class="line">            X509v3 Extended Key Usage:</span><br><span class="line">                TLS Web Server Authentication</span><br><span class="line">            X509v3 Subject Alternative Name:</span><br><span class="line">                DNS:ciam-ali1.west.isilon.com</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         09:6b:25:4e:ca:a1:<span class="built_in">fc</span>:2c:bb:35:5f:65:c8:47:92:7a:a1:53:</span><br><span class="line">         b7:fd:6e:41:5a:39:32:35:87:b1:24:de:83:6e:23:6c:67:49:</span><br><span class="line">         47:ba:91:de:7a:b1:81:f3:0a:3a:d3:25:35:13:6d:0f:d9:77:</span><br><span class="line">         a4:6a:7e:a6:72:06:d9:b1:95:15:36:61:46:a4:b7:0f:16:c3:</span><br><span class="line">         41:55:aa:e1:5c:93:28:4b:f0:9b:74:04:a1:08:59:97:23:c9:</span><br><span class="line">         1b:17:d0:38:7d:74:e4:9a:42:e2:f7:0a:2d:01:8d:d3:7f:57:</span><br><span class="line">         eb:b8:08:2e:fe:5f:b1:86:90:d2:97:64:9e:9a:61:51:06:9e:</span><br><span class="line">         7c:25:a9:87:5c:63:e6:d5:18:9b:cb:0e:20:71:77:06:fd:2e:</span><br><span class="line">         0f:c1:b9:21:75:34:ec:5a:11:4d:48:f8:4d:de:67:7a:f4:e6:</span><br><span class="line">         3c:a1:4a:01:40:8f:ce:2c:c1:ae:5e:52:66:0d:6c:29:7b:f0:</span><br><span class="line">         b3:ce:ae:b2:cf:13:d1:0e:ed:83:e3:15:16:5a:8c:ba:15:45:</span><br><span class="line">         08:46:b6:63:92:66:ab:2c:2c:1c:f6:2c:34:d9:7d:9f:b6:d3:</span><br><span class="line">         07:34:72:bb:89:81:27:d0:88:0f:b9:3e:e8:f2:3a:3c:7f:5c:</span><br><span class="line">         88:88:1b:77:7a:41:a9:c9:99:2f:e5:76:87:8e:26:ec:85:c0:</span><br><span class="line">         12:ac:02:25</span><br><span class="line">CIAM-ali1:~/CAcerts <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="vx_images/116433111278673.png"><br><img src="/uploads/116433111278673.png"></p>
<p><strong>个人或组织提交CRS 给 CA 机构， CA签发</strong></p>
<h2 id="2-SSL-amp-TLS-安全套接协议"><a href="#2-SSL-amp-TLS-安全套接协议" class="headerlink" title="2. SSL&amp;TLS  安全套接协议"></a>2. SSL&amp;TLS  安全套接协议</h2><p><MARK>SSL: Secure Sockets Layer（安全套接层协议), 与HTTPS一起诞生<br>TLS: TLS，Transport Layer Security（传输层安全性协议）， 是SSL 标准化<br>SSL &amp; TLS： 本质是同一个东东</MARK></p>
<blockquote>
<p>SSL是 Secure Sockets Layer（安全套接层协议）的缩写。由网景公司再1994年随HTTPS一起推出。<br>后交由IETF将SSL进行标准化，并改名为 TLS，Transport Layer Security（传输层安全性协议）。<br>所以 TLS 是 SSL 改个名而已，其实是一个东西。</p>
</blockquote>
<h3 id="2-1-SSL-分两层：-record-layer记录层-和-传输层"><a href="#2-1-SSL-分两层：-record-layer记录层-和-传输层" class="headerlink" title="2.1. SSL 分两层： record layer记录层 和 传输层"></a>2.1. SSL 分两层： record layer记录层 和 传输层</h3><p>记录层： 确定传输层的封装格式<br>传输层： 使用x509认证<br>然后，用非对称加密算法来对双方进行身份认证<br>再然后，<mark>交换对称密钥，作为session key，</mark> 给通信双方的data做加密</p>
<h3 id="2-2-SSL-证书有三种：-DV-OV-EV"><a href="#2-2-SSL-证书有三种：-DV-OV-EV" class="headerlink" title="2.2. SSL 证书有三种： DV, OV, EV"></a>2.2. SSL 证书有三种： DV, OV, EV</h3><ul>
<li>DV（Domain Validation）域名验证型证书，面向个体用户，可以通过邮箱验证、DNS验证或者文件验证</li>
<li>OV（Organization Validation）企业验证型证书，面向企业用户，CA 通过拨打信息库中公司的电话来确认；</li>
<li>EV（Extended Validation）增强验证型证书，证书审核级别为所有类型最严格验证方式， 银行，金融。</li>
</ul>
<h2 id="3-openssl-安全套接字层密码库，实现自签名证书"><a href="#3-openssl-安全套接字层密码库，实现自签名证书" class="headerlink" title="3. openssl 安全套接字层密码库，实现自签名证书"></a>3. openssl 安全套接字层密码库，实现自签名证书</h2><blockquote>
<p>可参考系列文章：<br><a href="https://angellaugh.github.io/2023/04/01/openssl/">openssl</a><br><a href="https://angellaugh.github.io/2023/03/28/openssl_2_signed/">openssl2:self-signed certificate</a></p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/04/02/openssl_ca2/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/04/01/multiprotocol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/01/multiprotocol/" class="post-title-link" itemprop="url">Multiprocess_1 tasks</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-01 15:37:02" itemprop="dateCreated datePublished" datetime="2023-04-01T15:37:02+00:00">2023-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">core_num = multiprocessing.cpu_count()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;corenum: <span class="subst">&#123;core_num&#125;</span>&quot;</span>)</span><br><span class="line">clients = [<span class="string">&quot;eb380adf-8fe8-45dd-825f-4e7da940eca9&quot;</span>,<span class="string">&quot;990f5d3c-5e5f-4af8-b68b-1329272ac3b4&quot;</span>,</span><br><span class="line">           <span class="string">&quot;15cc0813-8a2e-4a90-9ba6-7a8ddf3bd32d&quot;</span>,<span class="string">&quot;5bf8729e-fb28-476e-b054-5a0656dc4fed&quot;</span>,</span><br><span class="line">           <span class="string">&quot;27a1e6bb-439b-475e-bbcf-9744622992cd&quot;</span>,<span class="string">&quot;6491b68c-5360-4638-8194-da9f5431c4eb&quot;</span>,</span><br><span class="line">           <span class="string">&quot;da2fd513-acdc-48e9-b9fe-c0de13e90eb0&quot;</span>,<span class="string">&quot;f75d48b0-74ab-4d96-b8a7-4357985e78bc&quot;</span>,</span><br><span class="line">           <span class="string">&quot;d76c8dbe-0821-4736-a4fa-9b60dc331fec&quot;</span>,<span class="string">&quot;354f9ef4-1481-469a-9e6a-9cef076b4ac0&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">将clients_list 按core_num 随机分布client数量，这里core=4，</span></span><br><span class="line"><span class="string">那么会将 clients 分成四组，for 循环每次调用 chunks，都取一组给 for clients_，</span></span><br><span class="line"><span class="string">然后 for clients_ 可以拿去做事。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chunks</span>(<span class="params">clients_list, num</span>):</span><br><span class="line">    d, r = <span class="built_in">divmod</span>(<span class="built_in">len</span>(clients_list), num)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;d and r: <span class="subst">&#123;d&#125;</span>, <span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        si = (d + <span class="number">1</span>) * (i <span class="keyword">if</span> i &lt; r <span class="keyword">else</span> r) + d * (<span class="number">0</span> <span class="keyword">if</span> i &lt; r <span class="keyword">else</span> i - r)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;si: <span class="subst">&#123;si&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">yield</span> clients_list[si:si + (d + <span class="number">1</span> <span class="keyword">if</span> i &lt; r <span class="keyword">else</span> d)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> clients_ <span class="keyword">in</span> chunks(clients, core_num):</span><br><span class="line">    <span class="keyword">from</span> pdb <span class="keyword">import</span> set_trace</span><br><span class="line">    set_trace()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;clients_: <span class="subst">&#123;clients_&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;chunks: <span class="subst">&#123;chunks&#125;</span>&quot;</span>)</span><br><span class="line">```    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">```bash</span><br><span class="line"></span><br><span class="line">    corenum: <span class="number">8</span></span><br><span class="line">    d <span class="keyword">and</span> r: <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">    si: <span class="number">0</span></span><br><span class="line">    ipdb&gt; l</span><br><span class="line">    ipdb&gt; clients_</span><br><span class="line">    [<span class="string">&#x27;eb380adf-8fe8-45dd-825f-4e7da940eca9&#x27;</span>, <span class="string">&#x27;990f5d3c-5e5f-4af8-b68b-1329272ac3b4&#x27;</span>]</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    clients_: [<span class="string">&#x27;eb380adf-8fe8-45dd-825f-4e7da940eca9&#x27;</span>, <span class="string">&#x27;990f5d3c-5e5f-4af8-b68b-1329272ac3b4&#x27;</span>]</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    chunks: &lt;function chunks at <span class="number">0x10c2f6310</span>&gt;</span><br><span class="line">    ipdb&gt; s</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; i</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    si: <span class="number">2</span></span><br><span class="line">    ipdb&gt; si=<span class="number">2</span>,  i1&lt;r2所以返回d+<span class="number">1</span>=<span class="number">3</span>, 也就是返回clients_list[<span class="number">2</span>:<span class="number">2</span>+<span class="number">3</span>],即第<span class="number">3</span>，<span class="number">4</span>，<span class="number">5</span>个元素]</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    &gt; [<span class="number">0</span>;32m&lt;ipython-<span class="built_in">input</span>-<span class="number">1</span>-fca5ddbf22de&gt;[0m(<span class="number">30</span>)[<span class="number">0</span>;36m&lt;module&gt;[<span class="number">0</span>;34m()[0m</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    clients_: [<span class="string">&#x27;15cc0813-8a2e-4a90-9ba6-7a8ddf3bd32d&#x27;</span>, <span class="string">&#x27;5bf8729e-fb28-476e-b054-5a0656dc4fed&#x27;</span>]</span><br><span class="line">    ipdb&gt; s</span><br><span class="line">     ipdb&gt; n</span><br><span class="line">    si: <span class="number">4</span></span><br><span class="line"> </span><br><span class="line">    ipdb&gt; i</span><br><span class="line">    <span class="number">2</span></span><br><span class="line">    ipdb&gt; si=<span class="number">4</span>, i=<span class="number">2</span>不小于r=<span class="number">2</span>,于是返回d，[<span class="number">4</span>,<span class="number">6</span>] 第<span class="number">5</span>，<span class="number">6</span>个元素</span><br><span class="line">    *** SyntaxError: cannot assign to literal</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    clients_: [<span class="string">&#x27;27a1e6bb-439b-475e-bbcf-9744622992cd&#x27;</span>]   </span><br><span class="line">    ipdb&gt; 哦 上一步应该是[<span class="number">4</span>,<span class="number">5</span>] d=<span class="number">1</span>记错了</span><br><span class="line">    *** SyntaxError: invalid syntax</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    chunks: &lt;function chunks at <span class="number">0x10c2f6310</span>&gt;</span><br><span class="line">    ipdb&gt; s</span><br><span class="line">    --Call--</span><br><span class="line">    &gt; [<span class="number">0</span>;32m&lt;ipython-<span class="built_in">input</span>-<span class="number">1</span>-fca5ddbf22de&gt;[0m(<span class="number">25</span>)[<span class="number">0</span>;36mchunks[<span class="number">0</span>;34m()[0m</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    si: <span class="number">5</span></span><br><span class="line">    &gt; [<span class="number">0</span>;32m&lt;ipython-<span class="built_in">input</span>-<span class="number">1</span>-fca5ddbf22de&gt;[0m(<span class="number">25</span>)[<span class="number">0</span>;36mchunks[<span class="number">0</span>;34m()[0m</span><br><span class="line">    ipdb&gt; i</span><br><span class="line">    <span class="number">3</span></span><br><span class="line">    ipdb&gt; d</span><br><span class="line">    *** Newest frame</span><br><span class="line">    ipdb&gt; si=<span class="number">5</span>, 返回 <span class="number">5</span>+<span class="number">1</span>，也就是[<span class="number">5</span>,<span class="number">6</span>] 一个元素</span><br><span class="line">    *** SyntaxError: invalid syntax</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    clients_: [<span class="string">&#x27;6491b68c-5360-4638-8194-da9f5431c4eb&#x27;</span>]</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    chunks: &lt;function chunks at <span class="number">0x10c2f6310</span>&gt;</span><br><span class="line">    ipdb&gt; s</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    si: <span class="number">6</span></span><br><span class="line">    ipdb&gt; i</span><br><span class="line">    <span class="number">4</span></span><br><span class="line">    ipdb&gt; [<span class="number">6</span>:<span class="number">6</span>+<span class="number">1</span>]</span><br><span class="line">    *** SyntaxError: invalid syntax</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    clients_: [<span class="string">&#x27;da2fd513-acdc-48e9-b9fe-c0de13e90eb0&#x27;</span>]</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    chunks: &lt;function chunks at <span class="number">0x10c2f6310</span>&gt;</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    si: <span class="number">7</span></span><br><span class="line">    ipdb&gt; [<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">    [<span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    chunks: &lt;function chunks at <span class="number">0x10c2f6310</span>&gt;</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    si: <span class="number">8</span></span><br><span class="line">    ipdb&gt; [<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">    [<span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">    clients_: [<span class="string">&#x27;d76c8dbe-0821-4736-a4fa-9b60dc331fec&#x27;</span>]</span><br><span class="line"> </span><br><span class="line">    [0m</span><br><span class="line">    ipdb&gt; [<span class="number">9</span>,<span class="number">10</span>] 到这一步就结束啦</span><br><span class="line">    *** SyntaxError: invalid syntax</span><br><span class="line">    ipdb&gt; n</span><br><span class="line">    clients_: [<span class="string">&#x27;354f9ef4-1481-469a-9e6a-9cef076b4ac0&#x27;</span>]</span><br><span class="line">    ipdb&gt; 分给了<span class="number">8</span>个进程，第一个进程有<span class="number">3</span>个client要执行，另外<span class="number">7</span>个进程每个执行一个client</span><br><span class="line">    *** SyntaxError: invalid character <span class="string">&#x27;，&#x27;</span> (U+FF0C)</span><br><span class="line">    ipdb&gt; n</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/03/28/openssl_2_signed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/28/openssl_2_signed/" class="post-title-link" itemprop="url">OpenSSL2 self-signed certificate as root CA</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-28 22:41:02" itemprop="dateCreated datePublished" datetime="2023-03-28T22:41:02+00:00">2023-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          Here's something encrypted, password is required to continue reading.
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/03/28/openssl_2_signed/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/03/28/trypassword/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/28/trypassword/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-28 22:18:02" itemprop="dateCreated datePublished" datetime="2023-03-28T22:18:02+00:00">2023-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          Here's something encrypted, password is required to continue reading.
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/03/28/trypassword/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/03/15/saml2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/15/saml2/" class="post-title-link" itemprop="url">SAML 2.0</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-15 23:34:02" itemprop="dateCreated datePublished" datetime="2023-03-15T23:34:02+00:00">2023-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SAML2-0"><a href="#SAML2-0" class="headerlink" title="SAML2.0"></a>SAML2.0</h1><h3 id="Conception"><a href="#Conception" class="headerlink" title="Conception"></a>Conception</h3><blockquote>
<p> <strong>SAML</strong>, Security Assertion Markup Language</p>
</blockquote>
<blockquote>
<p> <strong>IDP identity provider</strong>， for instance, AD,  ADFS, LDAP, 身份认证authentication<br>    * Performs authentication and passes the user’s identity and authorization level to the service provider</p>
</blockquote>
<blockquote>
<p><strong>SP service provider</strong>, for instance, cluster, application,  access resources<br>    * Trusts the identity provider and authorizes the given user to access the requested resource.<br><code>credential 是啥？ idp authorization的是啥？</code></p>
</blockquote>
<ul>
<li>is the link between the authentication of a user’s identity and the authorization to use a service.</li>
<li>simplifies federated authentication and authorization processes for users, Identity providers, and service providers</li>
<li>enable sso, users can log in once, and those same credentials can be reused to log into other service providers</li>
<li>SAML authentication is the process of verifying the user’s identity and credentials (password, two-factor authentication, etc.). SAML authorization tells the service provider what access to grant the authenticated user.</li>
<li>authentication = verify identity + verify credential  验证身份和凭证， <font bgcolor=##FF7F50>不理解这个credential 是啥</font></li>
<li>SAML 做身份和凭证/资格的验证， SAML授权告诉SP 分配什么样的access 给通过验证的user</li>
<li>SAML 同时做了authentication and authorization</li>
<li>manage one login per user &gt; manage seperate logins to email, customer relationships management <strong>CRM</strong>, ADs.</li>
<li>简化了users, idp，sp之间的认证和授权流程。 authentication and authorization processes for users, Identity providers, and service providers.</li>
</ul>
<h3 id="Workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h3><ol>
<li>IDP 和 SP establish trust</li>
<li>user 在IDP 和 SP中都存在</li>
<li>user login from IDP, IDP验证通过后，生成SAML assertion，返回给user，</li>
<li>user拿着SAML assertion 到SP验证，如果通过，user就可以访问SP；<ol>
<li>SP 把SAML assertion中的user信息和 local的 user 对比验证，</li>
</ol>
</li>
<li>IDP 拿着SAML assertion 到另一个SP 去验证，也通过的话，user也可以SSO 访问 another application；</li>
</ol>
<h3 id="IDP-和-SP-的交流"><a href="#IDP-和-SP-的交流" class="headerlink" title="IDP 和 SP 的交流"></a>IDP 和 SP 的交流</h3><ol>
<li>IDP 和 SP 都config xml， contains settings and certificate of the system</li>
<li>this metadata exchange is establish the trust between IDP and SP like <code>Workflow point 1</code></li>
<li>this XML metadata file contains the form for the user identifier called <code>the name ID formats</code>, </li>
</ol>
<p><img src="/uploads/315430821585906.png"></p>
<p><img src="/uploads/149184710911054.png"></p>
<h3 id="2-ways-of-session-init"><a href="#2-ways-of-session-init" class="headerlink" title="2 ways of session init"></a>2 ways of session init</h3><p><img src="/uploads/288243668946728.png"></p>
<p><img src="/uploads/409973578816914.png"></p>
<h3 id="A-SAML-REQ-is-generated-from-SP-request-the-authentication-from-the-IDP"><a href="#A-SAML-REQ-is-generated-from-SP-request-the-authentication-from-the-IDP" class="headerlink" title="A SAML REQ, is generated from SP, request the authentication from the IDP"></a>A SAML REQ, is generated from SP, request the authentication from the IDP</h3><h3 id="A-SAML-RES-is-generated-from-the-IDP-contains-the-actual-assertion-of-authenticated-user-and-additional-user-profile"><a href="#A-SAML-RES-is-generated-from-the-IDP-contains-the-actual-assertion-of-authenticated-user-and-additional-user-profile" class="headerlink" title="A SAML RES, is generated from the IDP, contains the actual assertion of authenticated user, and additional user profile,"></a>A SAML RES, is generated from the IDP, contains the actual assertion of authenticated user, and additional user profile,</h3><p>such as group, role, depending on what the Service Provider can support.</p>
<h3 id="note"><a href="#note" class="headerlink" title="note"></a>note</h3><ol>
<li>SP 从不直接与IDP交流never directly interacts with IDP，browser 充当acts了执行carry out所有重定向的代理agent，acts as the agent to carry out all the redirections.</li>
<li>SP 知道要去找哪个 IDP；</li>
<li>SP在拿到 IDP返回的saml assertion之前是不知道 谁在要资源的，也就是说用户输入的用户名和密码，只传递到IDP，until the SAML assertion comes back from the Identity Provider.</li>
<li>可以直接从IDP认证，然后去访问SP，无需必须从SP发起请求；</li>
<li>SAML 身份验证流是异步的。SP不会维护生成的任何身份验证请求的任何状态。当 SP 收到来自 IDP 的响应时，响应必须包含所有必要的信息。</li>
</ol>
<h3 id="IdP-initiated-SSO-with-SAML-Authentication"><a href="#IdP-initiated-SSO-with-SAML-Authentication" class="headerlink" title="IdP-initiated SSO with SAML Authentication"></a>IdP-initiated SSO with SAML Authentication</h3><p><code>IDP 用之前和SP建立互信时产生的私钥来sign assertion， 然后通过user&#39;s browser 发给SP， 或者发送对assertion的引用。a reference to the assertion</code></p>
<p><code>SP receive the assertion, 用pub key来验证这个assertion是否真的来自它信任的IDP，以及验证这个assertion是否被修改过。 it validates the signature using the public key in order to ensure the SAML assertion really came from its trusted IDP</code></p>
<p><code>然后 SP 从 assertion中提取 extract identity和其他它需要的信息。</code></p>
<h3 id="SP-determine-which-IDP"><a href="#SP-determine-which-IDP" class="headerlink" title="SP determine which IDP"></a>SP determine which IDP</h3><ol>
<li>通过登录用户的域名， The SP may ask the user for their email address and use the domain of the email, such as  <a href="mailto:&#x70;&#x72;&#x69;&#116;&#x68;&#x76;&#x69;&#114;&#97;&#106;&#x2e;&#x67;&#97;&#105;&#x6b;&#119;&#97;&#100;&#64;&#x64;&#x65;&#x6c;&#108;&#46;&#x63;&#x6f;&#109;">&#x70;&#x72;&#x69;&#116;&#x68;&#x76;&#x69;&#114;&#97;&#106;&#x2e;&#x67;&#97;&#105;&#x6b;&#119;&#97;&#100;&#64;&#x64;&#x65;&#x6c;&#108;&#46;&#x63;&#x6f;&#109;</a></li>
<li>SP display a list of IDP,  user choose one </li>
<li>The resource URL may be specific to one IdP. </li>
<li>The SP may have placed a cookie containing IdP information in the user’s browser the first time the user successfully signed on from the IDP and will use this information on subsequent accesses.</li>
</ol>
<h3 id="The-saml-assertion’s-context"><a href="#The-saml-assertion’s-context" class="headerlink" title="The saml assertion’s context"></a>The saml assertion’s context</h3><p><img src="/uploads/589974006532594.png"></p>
<h3 id="SAML-IdP-Providers"><a href="#SAML-IdP-Providers" class="headerlink" title="SAML IdP Providers:"></a>SAML IdP Providers:</h3><ol>
<li>Active Directory Federation Services (ADFS)</li>
<li>Auth0</li>
<li>Azure AD (Microsoft Azure Active Directory)</li>
<li>Okta</li>
<li>OneLogin</li>
<li>Ping Identity</li>
<li>Salesforce</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://angellaugh.github.io/2023/03/14/keycloak/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Angellaugh">
      <meta itemprop="description" content="技术，生活，艺术，旅行，都记录下来">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Angellaugh's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/14/keycloak/" class="post-title-link" itemprop="url">KeyCloak</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-14 23:34:02" itemprop="dateCreated datePublished" datetime="2023-03-14T23:34:02+00:00">2023-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-17 09:11:31" itemprop="dateModified" datetime="2023-04-17T09:11:31+00:00">2023-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teckknowledge/" itemprop="url" rel="index"><span itemprop="name">Teckknowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="keycloak"><a href="#keycloak" class="headerlink" title="keycloak"></a>keycloak</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">keycloak-ali1:~/keycloak/keycloak-21.0.1/bin # sudo zypper refresh</span><br><span class="line">Repository &#x27;Update repository of openSUSE Backports&#x27; is up to date.</span><br><span class="line">Repository &#x27;Non-OSS Repository&#x27; is up to date.</span><br><span class="line">Repository &#x27;Main Repository&#x27; is up to date.</span><br><span class="line">Repository &#x27;Update repository with updates from SUSE Linux Enterprise 15&#x27; is up to date.</span><br><span class="line">Repository &#x27;Main Update Repository&#x27; is up to date.</span><br><span class="line">Repository &#x27;Update Repository (Non-Oss)&#x27; is up to date.</span><br><span class="line">All repositories have been refreshed.</span><br><span class="line">keycloak-ali1:~/keycloak/keycloak-21.0.1/bin # sudo zypper search openjdk-devel</span><br><span class="line">Loading repository data...</span><br><span class="line">Reading installed packages...</span><br><span class="line"></span><br><span class="line">S | Name                     | Summary                            | Type</span><br><span class="line">--+--------------------------+------------------------------------+--------</span><br><span class="line">  | java-1_8_0-openjdk-devel | OpenJDK 8 Development Environment  | package</span><br><span class="line">  | java-9-openjdk-devel     | OpenJDK 9 Development Environment  | package</span><br><span class="line">  | java-10-openjdk-devel    | OpenJDK 10 Development Environment | package</span><br><span class="line">  | java-11-openjdk-devel    | OpenJDK 11 Development Environment | package</span><br><span class="line">  | java-17-openjdk-devel    | OpenJDK 17 Development Environment | package</span><br><span class="line">keycloak-ali1:~/keycloak/keycloak-21.0.1/bin # sudo zypper --non-interactive install java-17-openjdk-devel</span><br><span class="line">Loading repository data...</span><br><span class="line">Reading installed packages...</span><br><span class="line">Resolving package dependencies...</span><br><span class="line"></span><br><span class="line">The following 2 recommended packages were automatically selected:</span><br><span class="line">  pcsc-lite timezone-java</span><br><span class="line"></span><br><span class="line">The following 11 NEW packages are going to be installed:</span><br><span class="line">  java-17-openjdk java-17-openjdk-devel java-17-openjdk-headless javapackages-filesystem javapackages-tools libXi6 libXtst6 libgif7 libpcsclite1</span><br><span class="line">  pcsc-lite timezone-java</span><br><span class="line"></span><br><span class="line">11 new packages to install.</span><br><span class="line">Overall download size: 43.9 MiB. Already cached: 0 B. After the operation, additional 189.6 MiB will be used.</span><br><span class="line">Continue? [y/n/v/...? shows all options] (y): y</span><br><span class="line">Retrieving package libXi6-1.7.9-3.2.1.x86_64                                                                  (1/11),  35.6 KiB ( 66.5 KiB unpacked)</span><br><span class="line">Retrieving: libXi6-1.7.9-3.2.1.x86_64.rpm ....................................................................................................[done]</span><br><span class="line">Retrieving package libXtst6-1.2.3-1.24.x86_64                                                                 (2/11),  17.2 KiB ( 22.4 KiB unpacked)</span><br><span class="line">Retrieving: libXtst6-1.2.3-1.24.x86_64.rpm ...................................................................................................[done]</span><br><span class="line">Retrieving package libgif7-5.2.1-150000.4.8.1.x86_64                                                          (3/11),  28.8 KiB ( 35.5 KiB unpacked)</span><br><span class="line">Retrieving: libgif7-5.2.1-150000.4.8.1.x86_64.rpm ............................................................................................[done]</span><br><span class="line">Retrieving package libpcsclite1-1.9.4-150400.1.9.x86_64                                                       (4/11),  32.8 KiB ( 38.4 KiB unpacked)</span><br><span class="line">Retrieving: libpcsclite1-1.9.4-150400.1.9.x86_64.rpm .........................................................................................[done]</span><br><span class="line">Retrieving package pcsc-lite-1.9.4-150400.1.9.x86_64                                                          (5/11),  82.2 KiB (140.4 KiB unpacked)</span><br><span class="line">Retrieving: pcsc-lite-1.9.4-150400.1.9.x86_64.rpm ............................................................................................[done]</span><br><span class="line">Retrieving package javapackages-filesystem-5.3.1-150200.3.4.4.x86_64                                          (6/11),  17.0 KiB (  1.9 KiB unpacked)</span><br><span class="line">Retrieving: javapackages-filesystem-5.3.1-150200.3.4.4.x86_64.rpm ................................................................[done (2.8 KiB/s)]</span><br><span class="line">Retrieving package timezone-java-2022g-150000.75.18.1.noarch                                                  (7/11), 155.0 KiB (341.2 KiB unpacked)</span><br><span class="line">Retrieving: timezone-java-2022g-150000.75.18.1.noarch.rpm ....................................................................................[done]</span><br><span class="line">Retrieving package javapackages-tools-5.3.1-150200.3.4.4.x86_64                                               (8/11),  37.7 KiB ( 71.6 KiB unpacked)</span><br><span class="line">Retrieving: javapackages-tools-5.3.1-150200.3.4.4.x86_64.rpm ...................................................................[done (129.7 KiB/s)]</span><br><span class="line">Retrieving package java-17-openjdk-headless-17.0.6.0-150400.3.12.1.x86_64                                     (9/11),  38.4 MiB (179.7 MiB unpacked)</span><br><span class="line">Retrieving: java-17-openjdk-headless-17.0.6.0-150400.3.12.1.x86_64.rpm ..........................................................[done (12.9 MiB/s)]</span><br><span class="line">Retrieving package java-17-openjdk-17.0.6.0-150400.3.12.1.x86_64                                             (10/11), 284.4 KiB (447.5 KiB unpacked)</span><br><span class="line">Retrieving: java-17-openjdk-17.0.6.0-150400.3.12.1.x86_64.rpm ..................................................................[done (869.5 KiB/s)]</span><br><span class="line">Retrieving package java-17-openjdk-devel-17.0.6.0-150400.3.12.1.x86_64                                       (11/11),   4.8 MiB (  8.8 MiB unpacked)</span><br><span class="line">Retrieving: java-17-openjdk-devel-17.0.6.0-150400.3.12.1.x86_64.rpm ..............................................................[done (7.8 MiB/s)]</span><br><span class="line"></span><br><span class="line">Checking for file conflicts: .................................................................................................................[done]</span><br><span class="line">( 1/11) Installing: libXi6-1.7.9-3.2.1.x86_64 ................................................................................................[done]</span><br><span class="line">( 2/11) Installing: libXtst6-1.2.3-1.24.x86_64 ...............................................................................................[done]</span><br><span class="line">( 3/11) Installing: libgif7-5.2.1-150000.4.8.1.x86_64 ........................................................................................[done]</span><br><span class="line">( 4/11) Installing: libpcsclite1-1.9.4-150400.1.9.x86_64 .....................................................................................[done]</span><br><span class="line">Created symlink /etc/systemd/system/sockets.target.wants/pcscd.socket -&gt; /usr/lib/systemd/system/pcscd.socket.</span><br><span class="line">Updating /etc/sysconfig/pcscd ...</span><br><span class="line">( 5/11) Installing: pcsc-lite-1.9.4-150400.1.9.x86_64 ........................................................................................[done]</span><br><span class="line">( 6/11) Installing: javapackages-filesystem-5.3.1-150200.3.4.4.x86_64 ........................................................................[done]</span><br><span class="line">( 7/11) Installing: timezone-java-2022g-150000.75.18.1.noarch ................................................................................[done]</span><br><span class="line">( 8/11) Installing: javapackages-tools-5.3.1-150200.3.4.4.x86_64 .............................................................................[done]</span><br><span class="line">update-alternatives: using /usr/lib64/jvm/jre-17-openjdk/bin/java to provide /usr/bin/java (java) in auto mode</span><br><span class="line">update-alternatives: using /usr/lib64/jvm/jre-17-openjdk to provide /usr/lib64/jvm/jre-openjdk (jre_openjdk) in auto mode</span><br><span class="line">update-alternatives: using /usr/lib64/jvm/jre-17-openjdk to provide /usr/lib64/jvm/jre-17 (jre_17) in auto mode</span><br><span class="line">( 9/11) Installing: java-17-openjdk-headless-17.0.6.0-150400.3.12.1.x86_64 ...................................................................[done]</span><br><span class="line">(10/11) Installing: java-17-openjdk-17.0.6.0-150400.3.12.1.x86_64 ............................................................................[done]</span><br><span class="line">update-alternatives: using /usr/lib64/jvm/java-17-openjdk/bin/javac to provide /usr/bin/javac (javac) in auto mode</span><br><span class="line">update-alternatives: using /usr/lib64/jvm/java-17-openjdk to provide /usr/lib64/jvm/java-openjdk (java_sdk_openjdk) in auto mode</span><br><span class="line">update-alternatives: using /usr/lib64/jvm/java-17-openjdk to provide /usr/lib64/jvm/java-17 (java_sdk_17) in auto mode</span><br><span class="line">(11/11) Installing: java-17-openjdk-devel-17.0.6.0-150400.3.12.1.x86_64 ......................................................................[done]</span><br><span class="line">Executing %posttrans scripts .................................................................................................................[done]</span><br><span class="line">keycloak-ali1:~/keycloak/keycloak-21.0.1/bin # javac -version</span><br><span class="line">javac 17.0.6</span><br></pre></td></tr></table></figure>



<h4 id="Realms"><a href="#Realms" class="headerlink" title="Realms"></a>Realms</h4><h5 id="Realms-are-isolated-from-one-another-and-can-only-manage-and-authenticate-the-users-that-they-control"><a href="#Realms-are-isolated-from-one-another-and-can-only-manage-and-authenticate-the-users-that-they-control" class="headerlink" title="Realms are isolated from one another and can only manage and authenticate the users that they control."></a>Realms are isolated from one another and can only manage and authenticate the users that they control.</h5><p><mark>You create a realm to provide a management space where you can create users and give them permissions to use applications.</mark></p>
<p><img src="/uploads/203023010625203.png"></p>
<h5 id="Set-Require-SSL-to-one-of-the-following-SSL-modes"><a href="#Set-Require-SSL-to-one-of-the-following-SSL-modes" class="headerlink" title="Set Require SSL to one of the following SSL modes:"></a>Set Require SSL to one of the following SSL modes:</h5><ul>
<li><p>External requests Users can interact with Keycloak without SSL so long as they stick to private IP addresses such as localhost, 127.0.0.1, 10.x.x.x, 192.168.x.x, and 172.16.x.x. If you try to access Keycloak without SSL from a non-private IP address, you will get an error.</p>
</li>
<li><p>None Keycloak does not require SSL. This choice applies only in development when you are experimenting and do not plan to support this deployment.</p>
</li>
<li><p>All requests Keycloak requires SSL for all IP addresses.</p>
</li>
</ul>
<p><img src="/uploads/354284833950954.png"></p>
<h5 id="Configuring-realm-keys"><a href="#Configuring-realm-keys" class="headerlink" title="Configuring realm keys"></a>Configuring realm keys</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Keycloak has a single active keypair at a time, but can have several passive keys as well. </span><br><span class="line">The active keypair is used to create new signatures, while the passive keypair can be used to verify previous signatures. </span><br><span class="line">This makes it possible to regularly rotate the keys without any downtime or interruption to users.</span><br><span class="line">Keycloak 一次只有一个主动密钥对，但也可以有多个被动密钥。主动密钥对用于创建新签名，而被动密钥对可用于验证以前的签名。</span><br><span class="line">这样就可以定期轮换密钥，而不会对用户造成任何停机或干扰。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>虽然reaml setting 的key中，是active，但是到底有没有使用它，取决于第一个选中的 key provider</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A keypair can have the status Active, but still not be selected as the currently active keypair for the realm. </span><br><span class="line">The selected active pair which is used for signatures is selected based on the first key provider sorted by priority that is able to provide an active keypair.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><mark>Once new keys are available all new tokens and cookies will be signed with the new keys.</mark></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. Once new keys are available all new tokens and cookies will be signed with the new keys.</span><br><span class="line"><span class="comment"># 一旦新的keys 生效，所有的token cookie都被signed with the new key.</span></span><br><span class="line">2. When a user authenticates to an application the SSO cookie is updated with the new signature.</span><br><span class="line"><span class="comment"># 当user authenticates login via sso，  那么 cookie 就随着 new signature update. </span></span><br><span class="line">3. When OpenID Connect tokens are refreshed new tokens are signed with the new keys. </span><br><span class="line"><span class="comment">#  当OpenID token 被refresh， 新的token 就被signed with new key.</span></span><br><span class="line">4. This means that over time all cookies and tokens will use the new keys and after a <span class="keyword">while</span> the old keys can be removed.</span><br><span class="line"><span class="comment"># 意味着 所有的cookie 和 token 都在使用 new keys， 并且，after a while old key 就被remove 了。</span></span><br><span class="line"></span><br><span class="line">这里的 after a <span class="keyword">while</span>：删除旧密钥的频率是安全性与确保所有 cookie 和令牌更新之间的权衡。</span><br><span class="line">The frequency of deleting old keys is a tradeoff between security and making sure all cookies and tokens are updated.</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> instance:  create new keys 3~6 months,  delete old keys 1~2 months. 如果user 在这期间old key 被删了，新key没有，那么重新登录认证即可。</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h6 id="Adding-a-generated-keypair"><a href="#Adding-a-generated-keypair" class="headerlink" title="Adding a generated keypair"></a>Adding a generated keypair</h6><p>更改优先级不会生成新key，但是edit keysize 会触发生成新key<br><img src="/uploads/595696697899358.png"></p>
<p>####### Compromised keys<br>keycloak has the signing keys stored just locally 将签名密钥存储在本地， 不会分享给其他user或者application<br>如果认为签名密钥已经泄露，可以立即生成新密钥对，并且删除旧密钥，甚至考虑删除provider。</p>
<h5 id="Using-external-storage-正是需要的"><a href="#Using-external-storage-正是需要的" class="headerlink" title="Using external storage 正是需要的"></a>Using external storage 正是需要的</h5><p>一般不会把包含有信息，密码，其他凭证等的数据库迁移到keycloak去。<br>keycloak支持已经存在的外部用户数据库，比如LDAP, AD。<br>用户也可以通过keycloak user storage API 来为任何 custom user database 编写扩展代码。</p>
<p>当用户尝试登陆时，keycloak 会检查该用户的存储以查找该用户，如果找不到的话，就会遍历当前realm的所有 user storage provider，直到直到匹配项。</p>
<p>来自外部data storage 的user 会 映射map到keycloak运行时使用的标准用户模型。然后，这个标准用户模型映射到 OIDC token claims 令牌声明和 SAML assertion attributes。</p>
<p>external user database 几乎不会完整支持keycloak的所有功能。<br>因此，User storage provider 可以选择性的存储items 到keycloak user data storage中。<br>User storage provider 可以在本地导入用户，并定期与外部数据存储同步。<br>但是这取决于external user database是否支持OTP， OTP可以通过Keycloak处理和存储。</p>
<blockquote>
<p>一次性密码（One Time Password，简称OTP），又称“一次性口令”，是指只能使用一次的密码。 一次性密码是根据专门算法、每隔60秒生成一个不可预测的随机数字组合  </p>
</blockquote>
<h6 id="Add-a-provider-kerberos-provider-or-LDAP-provicer"><a href="#Add-a-provider-kerberos-provider-or-LDAP-provicer" class="headerlink" title="Add a provider: kerberos provider or LDAP provicer"></a>Add a provider: kerberos provider or LDAP provicer</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user federation &gt; can choose kerberos provider or LDAP provicer</span><br></pre></td></tr></table></figure>

<p>一个 keycloak realm 可以 federate multiple different LDAP servers. 并且把ldap user 映射成keycloak的通用user model。</p>
<p>keycloak 默认映射username,  email， first/last name, 也可以configure additional mappings.<br>usermap: email</p>
<p>fullname: firstname and lastname</p>
<p>Hardcoded Attribute Mapper</p>
<p>Role Mapper: 通常是group， 从LDAP map 到 keycloak对应的role group， 比如：</p>
<ol>
<li>from groups under <mark>ou=main</mark>,dc=example,dc=org map to <mark>realm role mappings</mark>, </li>
<li>from groups under <mark>ou=finance</mark>,dc=example,dc=org map to <mark>client role mappings of client finance</mark>.</li>
</ol>
<p>Group Mapper</p>
<p><mark>Certificate Mapper</mark></p>
<p>此映射器映射 X.509 证书。Keycloak 将其与 X.509 身份验证和 PEM 格式的完整证书结合使用，作为身份源。此映射器的行为类似于用户属性映射器，但 Keycloak 可以过滤存储 PEM 或 DER 格式证书的 LDAP 属性。使用此映射器启用始终从 LDAP 读取值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This mapper maps X.509 certificates. Keycloak uses it in conjunction with X.509 authentication and Full certificate in PEM format as an identity source. This mapper behaves similarly to the User Attribute Mapper, but Keycloak can filter for an LDAP attribute storing a PEM or DER format certificate. Enable Always Read Value From LDAP with this mapper.</span><br></pre></td></tr></table></figure>



<h6 id="Dealing-with-provider-failures"><a href="#Dealing-with-provider-failures" class="headerlink" title="Dealing with provider failures"></a>Dealing with provider failures</h6><ul>
<li><p>Keycloak 先查询本地数据库来解析user，然后才考虑LDAP 或者其他custom user storage provider.<br>最好在keycloak 本地建立admin account，以防连接到 LDAP 和后端时出现问题。</p>
</li>
<li><p>任何external user storage provider 在admin 控制台都有<code>一个enable 开关</code><br>external user storage provider(ldap or custom user storage provicer) <code>has an enable toggle</code> on </p>
</li>
<li><p>如果您的提供程序使用导入策略并被禁用，则导入的用户仍可在只读模式下进行查找。<br>If your provider uses an import strategy and is disabled, imported users are still available for lookup in read-only mode.</p>
</li>
<li><p>Duplicate usernames and emails can cause problems</p>
</li>
</ul>
<h6 id="Storage-mode"><a href="#Storage-mode" class="headerlink" title="Storage mode"></a>Storage mode</h6><ul>
<li><p>keycloak 将LDAP user 同步到本地（定期或后台），但是不会同步密码， <code>password validation 只会在LDAP server上执行。</code><br>Password validation always occurs on the LDAP server.</p>
</li>
<li><p> 用户第一次登录keycloak时候，keycloak都会将它写入本地database。 Keycloak performs a corresponding database insert.</p>
</li>
<li><p> 可以但非必要，同步LDAP。 can synchronize， but unnecessary.</p>
</li>
<li><p>您可以将 LDAP 与 Keycloak 一起使用，而无需将用户导入 Keycloak 用户数据库。LDAP 服务器备份 Keycloak 运行时使用的通用用户模型</p>
</li>
</ul>
<p><mark>如果选择 disable import users, 就无法将 user profile attributes 用户配置文件属性保存到keycloak中。</mark><br><mark>user profile attributes metadata mapped to the ldap 可以保存到keycloak中， 但是 user metadata不能被保存，user metadata=[role mappings, group mappings, other metadata based on the ldap mappers.]</mark></p>
<p><mark>如果禁用导入用户，则无法将用户配置文件属性保存到 Keycloak 数据库中。 此外，除了映射到 LDAP 的用户配置文件元数据之外，您无法保存元数据。 此元数据可以包括角色映射、组映射和其他基于 LDAP 映射器配置的元数据。</mark></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">If you disable Import Users, you cannot save user profile attributes into the Keycloak database. </span><br><span class="line">Also, you cannot save metadata except for user profile metadata mapped to the LDAP. </span><br><span class="line">This metadata can include role mappings, group mappings, and other metadata based on the LDAP mappers&#x27; configuration.</span><br></pre></td></tr></table></figure>

<p><strong>UNSYNCED</strong><br>keycloak 会把 更改 username, email, password 的动作保存在local，这些信息需要同步回ldap， must synchronize this data back to LDAP</p>
<p>当 Keycloak 创建 LDAP 提供程序时，Keycloak 还会创建一组初始 LDAP 映射器。Keycloak 根据供应商、编辑模式和导入用户开关的组合来配置这些映射器。<br>based on a combination of the Vendor, Edit Mode, and Import Users switches.</p>
<p><strong>Sync Registrations</strong><br>Toggle this switch to ON if you want new users created by Keycloak added to LDAP</p>
<ul>
<li><p>当选择 import user， 用户第一次登录后，从keycloak admin那里查看all user，会看到验证过的user展示在这里，意思是已经导入了，keycloak只在user 第一次login时候导入，而不是一次性导入整个LDAP的所有user。</p>
</li>
<li><p>如果想一次性同步所有user，有2种方式</p>
</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">If you want to sync all LDAP users into the Keycloak database, configure and enable the Sync Settings on the LDAP provider configuration page.</span><br><span class="line"></span><br><span class="line">1. Periodic Full sync</span><br><span class="line">此类型将所有 LDAP 用户同步到 Keycloak 数据库中。已经在Keycloak中但与LDAP不同的LDAP用户直接在Keycloak数据库中更新。</span><br><span class="line">2. Periodic Changed users sync</span><br><span class="line">同步时，Keycloak 仅创建或更新在上次同步后创建或更新的用户。</span><br></pre></td></tr></table></figure>

<ul>
<li>最佳同步策略： 在创建LDAP provider时，选择 <code>Synchronize all users</code>, 然后 <code>Synchronize all users</code><br>The best way to synchronize is to click Synchronize all users when you first create the LDAP provider, then set up Synchronize all usersSynchronize all users</li>
</ul>
<p><img src="/uploads/86293028586002.png"></p>
<h6 id="Password-hashing"><a href="#Password-hashing" class="headerlink" title="Password hashing"></a>Password hashing</h6><p>当 Keycloak 更新密码时，Keycloak 以纯文本格式发送密码。<br>此操作不同于在内置 Keycloak 数据库中更新密码，Keycloak 在将密码发送到数据库之前对密码进行哈希处理和加盐处理。<br>对于 LDAP，Keycloak 依赖于 LDAP 服务器对密码进行散列和加盐。</p>
<ol>
<li>By default, LDAP servers such as MSAD, RHDS, or FreeIPA hash and salt passwords. </li>
<li>Other LDAP servers such as OpenLDAP or ApacheDS store the passwords in plain-text unless you use the LDAPv3 Password Modify Extended Operation as described in RFC3062. </li>
<li>Always verify that user passwords are properly hashed and not stored as plaintext by inspecting a changed directory entry using ldapsearch and base64 decode the userPassword attribute value.</li>
</ol>
<h4 id="Authentication-flow"><a href="#Authentication-flow" class="headerlink" title="Authentication flow"></a>Authentication flow</h4><p>flow是一个在登陆，注册或者其他workflow时候要进行的 身份验证，屏幕 和 操作。<br>An authentication flow is a container of<br>authentications, screens, and actions, during log in, registration, and other Keycloak workflows.<br>To view all the flows, actions, and checks, each flow requires:</p>
<h5 id="browser-里面的-Forms："><a href="#browser-里面的-Forms：" class="headerlink" title="browser 里面的 Forms："></a><strong>browser 里面的 Forms：</strong></h5><p>先说cookie，user 首次登陆成功后，keycloak会 sets a session cookie.<br>如果这个cookie已经存在了，authentication type=success, cookie provider return success,<br>而同级其他验证方式都是alternative可选的， 那么keycloak不会再执行任何操作，这次请求会返回一个successful login.</p>
<p>而这里的Forms， 是个可选的子flow alternative sub-flow，它能不能被执行，取决于它的parent status.<br>它包含了一个需要被执行的额外验证项目，因此如果想这个form被执行，就需要删掉cookie 验证。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Since this sub-flow is marked as alternative, it will not be executed if the Cookie authentication type passed. </span><br><span class="line">This sub-flow contains an additional authentication type that needs to be executed. Keycloak loads the executions for this sub-flow and processes them.</span><br></pre></td></tr></table></figure>

<h5 id="验证步骤"><a href="#验证步骤" class="headerlink" title="验证步骤"></a>验证步骤</h5><ol>
<li>Username Password Form, 在browser flow中，这个选项是required，并且不可更改， 需要用户输入uname+pwd</li>
<li> Browser - Conditional OTP sub-flow， 它是based on the Condition-user configured</li>
<li>Condition - User Configured. This authentication checks if Keycloak has configured other executions in the flow for the user</li>
<li>OTP Form Keycloak 将此执行标记为必需，但仅当用户由于条件子流中的设置而设置了 OTP 凭据时，它才会运行。否则，用户不会看到 OTP 表单。</li>
</ol>
<p><mark>可以添加新的空白flow，也可以copy已经存在的flow， 里面的action有很多种， from sending a reset email to validating an OTP.</mark><br><mark>可以建立sub-flow, 可以拖动顺序</mark></p>
<p><img src="/uploads/151286775946824.png"></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.keycloak.org/docs/latest/server_admin/#configuring-authentication_server_administration_guide">https://www.keycloak.org/docs/latest/server_admin/#configuring-authentication_server_administration_guide</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Angellaugh"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">Angellaugh</p>
  <div class="site-description" itemprop="description">技术，生活，艺术，旅行，都记录下来</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Angellaugh</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
